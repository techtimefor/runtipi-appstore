#!/bin/bash

CONFIG_FILE="/crafty/app/config/config.yml"
PORT="${PORT:-8443}"

echo "🛠️ Setting Crafty web UI port to ${PORT}"

# Patch the config file safely
if [ -f "$CONFIG_FILE" ]; then
  if grep -q "^port:" "$CONFIG_FILE"; then
    sed -i "s/^port:.*/port: ${PORT}/" "$CONFIG_FILE"
  else
    echo "port: ${PORT}" >> "$CONFIG_FILE"
  fi
else
  echo "⚠️ Config file not found at $CONFIG_FILE. Creating new one..."
  echo "port: ${PORT}" > "$CONFIG_FILE"
fi

echo "🚀 Starting Crafty..."
exec python3 crafty.py